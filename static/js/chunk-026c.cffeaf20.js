(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-026c"],{40:function(e,n){},41:function(e,n){},"6ure":function(e,n,t){"use strict";var o=t("fKcG");t.n(o).a},M0Sx:function(e,n,t){},fKcG:function(e,n,t){},nsc6:function(e,n,t){"use strict";var o=t("gDS+"),r=t.n(o),s=t("4d7F"),c=t.n(s),a=t("14Xm"),i=t.n(a),l=t("D3Ub"),u=t.n(l),f=t("F8hq"),g=t("fcXd"),p=(t("t+wR"),t("lMCj")),d=function(){var e=u()(i.a.mark(function e(n,t){var o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=Object(f.asciiToTrytes)(r()(n)),s=p.create(t,o),e.next=5,p.attach(s.payload,s.address,3,10);case 5:return e.abrupt("return",{root:s.root,state:s.state});case 8:return e.prev=8,e.t0=e.catch(0),console.log("publish error",e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}},e,void 0,[[0,8]])}));return function(n,t){return e.apply(this,arguments)}}(),h=function(e,n){console.log("readStream:: (seed, key)",e,n);var t=p.init(g.a,e,2);console.log("state_object",t),t=p.changeMode(t,"restricted",n);var o=p.getRoot(t);return console.log("root",o),new c.a(function(){var e=u()(i.a.mark(function e(r,s){var c,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("state_object",t),c=void 0,a=function(e){console.log("convertData",e);var n=JSON.parse(Object(f.trytesToAscii)(e));console.log("result",n),c=n},e.next=6,p.fetch(o,"restricted",n,a);case 6:return console.log("offer",c),e.abrupt("return",r(c));case 10:return e.prev=10,e.t0=e.catch(0),console.log("createMAMChannel error",e.t0),e.abrupt("return",s());case 14:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(n,t){return e.apply(this,arguments)}}())},v=t("Wj4w"),_=t("BRrH"),w={data:function(){return{creating:!1,peer:null,answer:!1,connection_url:"",offer:"",waiting_for_connection:!1,seed:"",loading:!1,connected:!0,messages:[],new_message:""}},created:function(){var e=this;console.log("connector started"),console.log("Seed",this.$route.query.seed);var n=this.$route.query.seed;if(n){this.peer=new _({initiator:!1,trickle:!1}),this.peer.on("data",function(n){console.log("got a message from peer1: "+n);var t=String.fromCharCode.apply(null,n);console.log("got a message from peer1 -converted: "+t),e.messages.push(t)});var t=this.$route.query.key;console.log("Key",t),h(n,t).then(function(o){if(console.log("data",o),"offer"===o.type){console.log("its an offer!"),console.log("sucess getConnectionData ",o);var s=e;e.peer.signal(o),e.peer.on("signal",function(e){console.log("data peer2",e),"answer"===e.type&&(function(e,n,t){return console.log("createAnswer(seed, key, answer)",e,n,t),new c.a(function(){var o=u()(i.a.mark(function o(r,s){var c,a;return i.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return c=p.init(g.a,e,2),console.log("state_object",c),c=p.changeMode(c,"restricted",n),console.log("state_object",c),o.prev=4,console.log("plublish mam..."),o.next=8,d(t,c);case 8:return a=o.sent,console.log("mam plublish!"),a&&(a.root=a.root,a.secretKey=a.state.channel.secretKey,a.next_root=a.state.channel.next_root,a.start=a.state.channel.start),o.abrupt("return",r(a));case 14:return o.prev=14,o.t0=o.catch(4),console.log("MAM append error",o.t0),o.abrupt("return",s());case 18:case"end":return o.stop()}},o,void 0,[[4,14]])}));return function(e,n){return o.apply(this,arguments)}}())}(n,t,e).then(function(e){console.log("createAnswer ",e)}).catch(function(e){console.log("err getConnectionData ",e)}),s.answer=r()(e))})}}).catch(function(e){console.log("err getConnectionData ",e)})}else console.log("no seed providet "),this.creating=!0,this.answer=""},methods:{createOffer:function(){var e=this;this.peer=new _({initiator:!0,trickle:!1}),console.log("peer",this.peer),this.loading=!0;var n=this;this.peer.on("signal",function(e){if(console.log("data",e),"offer"===e.type){n.seed=Object(v.j)();n.connection_url="http://localhost:9528/#/connection?seed="+n.seed+"&key=H",console.log("SEED",n.seed),this.waiting_for_connection=!0,function(e,n,t){var o=p.init(g.a,e,2);return o=p.changeMode(o,"restricted",n),new c.a(function(){var n=u()(i.a.mark(function n(r,s){var c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d(t,o);case 3:return(c=n.sent)&&(t.root=c.root,t.secretKey=c.state.channel.secretKey,t.next_root=c.state.channel.next_root,t.start=c.state.channel.start,t.seed=e),n.abrupt("return",r(t));case 8:return n.prev=8,n.t0=n.catch(0),console.log("createMAMChannel error",n.t0),n.abrupt("return",s());case 12:case"end":return n.stop()}},n,void 0,[[0,8]])}));return function(e,t){return n.apply(this,arguments)}}())}(n.seed,"H",e).then(function(e){console.log("sucess createWebRTC ",e),console.log("sucess root ",e.root),n.startWatcher(e.root)}).catch(function(e){console.log("err createWebRTC ",e)}),n.offer=r()(e)}}),this.peer.on("data",function(n){console.log("got a message from peer2: "+n);var t=String.fromCharCode.apply(null,n);console.log("got a message from peer2 -converted: "+t),e.messages.push(t)})},sendMessage:function(){this.peer.send(this.new_message)},startWatcher:function(e){var n=this;this.watcher=setInterval(function(){console.log("read stream from seed: ",this.seed),h(this.seed,"H").then(function(e){console.log("sucess createWebRTC ",e),e?"answer"===e.type?(console.log("answer found!",e),console.log("connect!"),console.log("peer",n.peer),n.peer.signal(e),n.peer.on("connect",function(){console.log("connected!!!"),n.connected=!0,n.peer.send("hey peer2, how is it going?")}),n.loading=!0,clearInterval(n.watcher)):"offer"===e.type?console.log("Data still in offer",e):console.log("something went wront",e):console.log("No new data found:",e)}).catch(function(e){console.log("err createWebRTC ",e)})}.bind(this),1e4)}}},m=(t("6ure"),t("KHd+")),b=Object(m.a)(w,function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"connection"},[t("h1",[e._v("Connection Handler")]),e._v(" "),e.loading?t("p",[e._v("Loading...")]):e._e(),e._v(" "),e.answer?t("p",[e._v(e._s(e.answer))]):e._e(),e._v(" "),t("p",[e._v(e._s(e.connection_url))]),e._v(" "),e.creating?t("div",[e.waiting_for_connection?e._e():t("el-button",{on:{click:e.createOffer}},[e._v("createOffer")])],1):e._e(),e._v(" "),t("div",{attrs:{id:"element"}},[e._v("\n        Hi. I'm #element.\n    ")]),e._v(" "),e.connected?t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.new_message,expression:"new_message"}],attrs:{type:"text"},domProps:{value:e.new_message},on:{input:function(n){n.target.composing||(e.new_message=n.target.value)}}}),e._v(" "),t("button",{on:{click:e.sendMessage}},[e._v("Send")]),e._v(" "),t("ul",e._l(e.messages,function(n,o){return t("li",{key:o},[e._v(e._s(n))])}))]):e._e()])},[],!1,null,null,null);b.options.__file="ConnectionHandler.vue";n.a=b.exports},q3oP:function(e,n,t){"use strict";var o=t("M0Sx");t.n(o).a},zWY5:function(e,n,t){"use strict";t.r(n);var o={components:{ConnectionHandler:t("nsc6").a}},r=(t("q3oP"),t("KHd+")),s=Object(r.a)(o,function(){var e=this.$createElement,n=this._self._c||e;return n("div",[n("h1",[this._v("Connection")]),this._v(" "),n("ConnectionHandler")],1)},[],!1,null,null,null);s.options.__file="index.vue";n.default=s.exports}}]);